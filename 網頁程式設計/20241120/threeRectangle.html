<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
canvas {
    border: 1px solid #d3d3d3;
    background-color: #f1f1f1;
}
</style>
</head>
<body onload="startGame()">

<script>
let squares = [];
let isRunning = false;

let start_stop = false;

function startGame() {
    gameArea.start();
    createSquares();
}

const gameArea = {
    canvas: document.createElement("canvas"),
    start: function () {
        if(!start_stop){
            start_stop = true;
            this.canvas.width = 480;
            this.canvas.height = 270;
            this.context = this.canvas.getContext("2d");
            document.body.insertBefore(this.canvas, document.body.childNodes[0]);
            this.interval = null;
        }
        else{
            squares.forEach((square) => {
                square.isPaused = false;
            }); 
        }
    },
    clear: function () {
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
    },
    stop: function () {
        squares.forEach((square) => {
                square.isPaused = true;
        });
    },
    reset: function () {
        start_stop = true;
        clearInterval(this.interval)
        this.stop();
        this.clear();
        squares = [];
        createSquares();
    }
};

function Square(x, y, size, color) {
    this.x = x;
    this.y = y;
    this.size = size;
    this.color = color;
    this.speedX = Math.random() < 0.5 ? 2 : -2;
    this.speedY = Math.random() < 0.5 ? 2 : -2;
    this.isPaused = false;

    this.draw = function () {
        const ctx = gameArea.context;
        ctx.fillStyle = this.color;
        ctx.fillRect(this.x, this.y, this.size, this.size);
    };

    this.updatePosition = function () {
        if (!this.isPaused) {
            this.x += this.speedX;
            this.y += this.speedY;

            // 邊界檢測與反彈
            if (this.x <= 0 || this.x + this.size >= gameArea.canvas.width) {
                this.speedX = -this.speedX;
            }
            if (this.y <= 0 || this.y + this.size >= gameArea.canvas.height) {
                this.speedY = -this.speedY;
            }
        }
        this.draw();
    };

    this.togglePause = function () {
        this.isPaused = !this.isPaused;
    };

    this.resume = function () {
        this.isPaused = false;
    };
}

function createSquares() {
    squares.push(new Square(50, 50, 50, "red"));
    squares.push(new Square(150, 150, 50, "yellow"));
    squares.push(new Square(300, 100, 50, "blue"));
    squares.forEach((square) => {
        // 為每個正方形增加事件監聽
        gameArea.canvas.addEventListener("click", (e) => {
            const rect = gameArea.canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            if (
                mouseX >= square.x &&
                mouseX <= square.x + square.size &&
                mouseY >= square.y &&
                mouseY <= square.y + square.size
            ) {
                square.togglePause();
            }
        });
    });
}

function updateGameArea() {
    gameArea.clear();
    squares.forEach((square) => square.updatePosition());
}

function start() {
    if (!isRunning) {
        isRunning = true;
        squares.forEach((square) => square.resume()); // 重設所有正方形為繼續運動
        gameArea.interval = setInterval(updateGameArea, 20);
    }
    gameArea.start();
}

function stop() {
    gameArea.stop();
}

function reset() {
    isRunning = false;
    gameArea.reset();
}
</script>

<br>
<button onclick="start()">Start</button>
<button onclick="stop()">Stop</button>
<button onclick="reset()">Reset</button>

</body>
</html>
